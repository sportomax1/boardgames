<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üéØ First Player Selector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            padding-top: max(env(safe-area-inset-top), 20px);
            padding-bottom: max(env(safe-area-inset-bottom), 20px);
            padding-left: max(env(safe-area-inset-left), 20px);
            padding-right: max(env(safe-area-inset-right), 20px);
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .app-title {
            text-align: center;
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #1e40af;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .method-selector {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .method-button {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            color: #fff;
            border: none;
            border-radius: 15px;
            padding: 18px 20px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(25, 118, 210, 0.3);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            width: 100%;
            min-height: 60px;
        }

        .method-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4);
        }

        .method-button.active {
            background: linear-gradient(135deg, #1e40af 0%, #1d4ed8 100%);
            box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3);
        }

        .method-content {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }

        .method-content.active {
            display: block;
        }

        /* Spinner Styles */
        .spinner-container {
            position: relative;
            width: min(300px, 90vw);
            height: min(300px, 90vw);
            margin: 0 auto 20px;
            touch-action: manipulation;
        }

        .spinner-circle {
            width: 100%;
            height: 100%;
            border: 6px solid #374151;
            border-radius: 50%;
            position: relative;
            background: radial-gradient(circle, #1f2937 0%, #111827 100%);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }

        .spinner-arrow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 3px;
            height: 40%;
            background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);
            transform-origin: bottom center;
            transform: translate(-50%, -100%);
            border-radius: 2px 2px 0 0;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.5);
        }

        .spinner-arrow::after {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-bottom: 12px solid #ef4444;
        }

        .spinner-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            background: #374151;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            border: 2px solid #6b7280;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .player-positions {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .player-position {
            position: absolute;
            width: 35px;
            height: 35px;
            background: #1e40af;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            border: 2px solid #1d4ed8;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.3);
            transition: all 0.3s ease;
        }

        .player-position.winner {
            background: #10b981;
            border-color: #059669;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        /* Player Count Input */
        .player-count-input {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .player-count-input label {
            font-size: 1.1em;
            font-weight: 600;
        }

        .player-count-input input {
            width: 80px;
            padding: 12px;
            border: 2px solid #374151;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.2em;
            text-align: center;
            -webkit-appearance: none;
            appearance: none;
        }

        .player-count-input input:focus {
            outline: none;
            border-color: #1e40af;
        }

        /* Action Buttons */
        .action-button {
            width: 100%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 18px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            min-height: 60px;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .action-button:disabled {
            background: #374151;
            cursor: not-allowed;
            transform: none;
        }

        /* Result Display */
        .result {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 20px;
            padding: 15px;
            background: rgba(16, 185, 129, 0.2);
            border-radius: 15px;
            border: 2px solid #10b981;
            display: none;
        }

        .result.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Random Prompts */
        .prompt-display {
            text-align: center;
            font-size: 1.4em;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            background: rgba(30, 64, 175, 0.2);
            border-radius: 15px;
            border: 2px solid #1e40af;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Directional Result */
        .direction-result {
            text-align: center;
            margin-top: 20px;
        }

        .direction-arrow {
            font-size: 3em;
            margin: 10px 0;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Touch Screen Method */
        .touch-instructions {
            text-align: center;
            margin-bottom: 20px;
        }

        .touch-instructions h3 {
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #1e40af;
        }

        .touch-instructions p {
            font-size: 1em;
            color: #9ca3af;
            margin: 0;
        }

        .touch-area {
            position: relative;
            width: 100%;
            height: min(400px, 50vh);
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border: 3px solid #374151;
            border-radius: 20px;
            margin-bottom: 20px;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .touch-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            color: #6b7280;
            pointer-events: none;
            text-align: center;
        }

        .countdown-display {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            font-weight: bold;
            color: #ef4444;
            display: none;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .touch-point {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            animation: touchPulse 2s infinite;
            pointer-events: none;
        }

        .touch-point.eliminated {
            animation: fadeOut 1s forwards;
        }

        .touch-point.winner {
            animation: winnerPulse 2s infinite;
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.6);
        }

        @keyframes touchPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        @keyframes fadeOut {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
        }

        @keyframes winnerPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 20px rgba(251, 191, 36, 0.6); }
            50% { transform: translate(-50%, -50%) scale(1.2); box-shadow: 0 0 30px rgba(251, 191, 36, 1); }
        }

        /* Color Picker Method */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 25px;
            max-width: 100%;
        }

        .color-option {
            aspect-ratio: 1;
            border-radius: 15px;
            border: 4px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 50px;
        }

        .color-option:hover {
            transform: scale(1.05);
            border-color: white;
        }

        .color-option.selected {
            border-color: #fbbf24;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        .color-option.winner {
            animation: colorWinner 2s infinite;
        }

        .color-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            text-align: center;
            padding: 5px;
            font-size: 0.8em;
            font-weight: bold;
        }

        @keyframes colorWinner {
            0%, 100% { transform: scale(1.1); box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
            50% { transform: scale(1.2); box-shadow: 0 0 30px rgba(251, 191, 36, 1); }
        }

        /* iPhone and mobile optimizations */
        @media screen and (max-width: 414px) {
            .app-title {
                font-size: 1.8em;
                margin-bottom: 15px;
            }
            
            .method-content {
                padding: 20px 15px;
                margin-bottom: 15px;
            }
            
            .spinner-container {
                width: min(280px, 85vw);
                height: min(280px, 85vw);
                margin-bottom: 15px;
            }
            
            .player-position {
                width: 30px;
                height: 30px;
                font-size: 1em;
            }
            
            .prompt-display {
                font-size: 1.2em;
                padding: 15px;
                min-height: 60px;
            }
            
            .direction-arrow {
                font-size: 2.5em;
            }
            
            .touch-area {
                height: min(350px, 45vh);
            }
            
            .touch-point {
                width: 50px;
                height: 50px;
                font-size: 1em;
            }
            
            .color-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 10px;
            }
            
            .color-option {
                min-height: 45px;
            }
            
            .color-label {
                font-size: 0.7em;
                padding: 3px;
            }
        }

        @media screen and (max-height: 700px) {
            .container {
                padding: 5px;
            }
            
            .app-title {
                font-size: 1.6em;
                margin-bottom: 10px;
            }
            
            .method-content {
                padding: 15px 10px;
            }
            
            .spinner-container {
                width: min(250px, 80vw);
                height: min(250px, 80vw);
                margin-bottom: 10px;
            }
            
            .touch-area {
                height: min(300px, 40vh);
            }
            
            .touch-instructions h3 {
                font-size: 1.1em;
                margin-bottom: 8px;
            }
            
            .touch-instructions p {
                font-size: 0.9em;
            }
        }

        @media screen and (max-height: 600px) {
            .touch-area {
                height: min(250px, 35vh);
            }
            
            .prompt-display {
                min-height: 50px;
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <button class="back-button" onclick="showMethodSelector()">‚Üê</button>
    
    <div class="container">
        <div class="app-title">üéØ First Player</div>
        
        <!-- Method Selection -->
        <div id="methodSelector" class="method-selector">
            <button class="method-button" onclick="selectMethod('spinner')">üé° Spinner Wheel</button>
            <button class="method-button" onclick="selectMethod('numbered')">üî¢ Number Selection</button>
            <button class="method-button" onclick="selectMethod('prompts')">üé≤ Random Prompts</button>
            <button class="method-button" onclick="selectMethod('quickspin')">‚ö° Quick Spin</button>
            <button class="method-button" onclick="selectMethod('touch')">üëÜ Touch Screen</button>
            <button class="method-button" onclick="selectMethod('colorpicker')">üé® Color Picker</button>
        </div>

        <!-- Spinner Method -->
        <div id="spinnerMethod" class="method-content">
            <div class="player-count-input">
                <label for="spinnerPlayers">Players:</label>
                <input type="number" id="spinnerPlayers" min="2" max="12" value="4">
            </div>
            <div class="spinner-container">
                <div class="spinner-circle">
                    <div id="spinnerArrow" class="spinner-arrow"></div>
                    <div class="spinner-center"></div>
                    <div id="playerPositions" class="player-positions"></div>
                </div>
            </div>
            <button class="action-button" onclick="spinWheel()">üé° SPIN THE WHEEL!</button>
            <div id="spinnerResult" class="result"></div>
        </div>

        <!-- Numbered Method -->
        <div id="numberedMethod" class="method-content">
            <div class="player-count-input">
                <label for="numberedPlayers">Players:</label>
                <input type="number" id="numberedPlayers" min="2" max="12" value="4">
            </div>
            <button class="action-button" onclick="selectRandomPlayer()">üî¢ PICK RANDOM PLAYER</button>
            <div id="numberedResult" class="result"></div>
        </div>

        <!-- Random Prompts Method -->
        <div id="promptsMethod" class="method-content">
            <div class="prompt-display" id="promptDisplay">
                Click the button below to get a random first player prompt!
            </div>
            <button class="action-button" onclick="generatePrompt()">üé≤ GENERATE PROMPT</button>
        </div>

        <!-- Quick Spin Method -->
        <div id="quickspinMethod" class="method-content">
            <div class="direction-result">
                <div class="prompt-display">Point your device at the group and spin!</div>
                <div class="direction-arrow" id="directionArrow">üß≠</div>
                <button class="action-button" onclick="quickSpin()">‚ö° QUICK SPIN</button>
                <div id="quickSpinResult" class="result"></div>
            </div>
        </div>

        <!-- Touch Screen Method -->
        <div id="touchMethod" class="method-content">
            <div class="touch-instructions">
                <h3>üñêÔ∏è All players place finger on screen</h3>
                <p>Each touch will get a different color. Last player remaining wins!</p>
            </div>
            <div class="touch-area" id="touchArea">
                <div class="touch-message">Touch here to begin...</div>
                <div class="countdown-display" id="countdownDisplay"></div>
            </div>
            <button class="action-button" id="touchStartBtn" onclick="startTouchGame()">üëÜ START TOUCH GAME</button>
            <button class="action-button" id="touchResetBtn" onclick="resetTouchGame()" style="display:none;">üîÑ RESET</button>
            <div id="touchResult" class="result"></div>
        </div>

        <!-- Color Picker Method -->
        <div id="colorpickerMethod" class="method-content">
            <div class="color-grid" id="colorGrid"></div>
            <button class="action-button" onclick="pickRandomColor()">üé® PICK RANDOM COLOR</button>
            <div id="colorResult" class="result"></div>
        </div>
    </div>

    <script>
        let currentMethod = null;
        let isSpinning = false;
        
        // Touch game variables
        let touchGame = {
            active: false,
            touches: new Map(),
            colors: ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16', '#f97316', '#6366f1'],
            colorIndex: 0,
            eliminationTimer: null,
            countdownTimer: null
        };

        // Color picker colors with names
        const colorOptions = [
            { color: '#ef4444', name: 'Red' },
            { color: '#3b82f6', name: 'Blue' },
            { color: '#10b981', name: 'Green' },
            { color: '#f59e0b', name: 'Yellow' },
            { color: '#8b5cf6', name: 'Purple' },
            { color: '#ec4899', name: 'Pink' },
            { color: '#06b6d4', name: 'Cyan' },
            { color: '#84cc16', name: 'Lime' },
            { color: '#f97316', name: 'Orange' },
            { color: '#6366f1', name: 'Indigo' }
        ];

        // Random prompts for first player selection
        const firstPlayerPrompts = [
            "First to arrive at the table",
            "Last to arrive at the table", 
            "Oldest player",
            "Youngest player",
            "Tallest player",
            "Shortest player",
            "Player wearing the most blue",
            "Player wearing the most red",
            "Player with the longest hair",
            "Player with the shortest hair",
            "Player who woke up earliest today",
            "Player who went to bed latest last night",
            "Player with the most pets",
            "Player with the most siblings",
            "Player who lives closest to here",
            "Player who lives farthest from here",
            "Player with the next birthday",
            "Player who had the most recent birthday",
            "Player with the most board games",
            "Player who has traveled to the most countries",
            "Player with the most letters in their first name",
            "Player with the fewest letters in their first name",
            "Player who can whistle the loudest",
            "Player who can count to 10 in the most languages",
            "Player with the most unusual hobby",
            "Player who has met the most famous people",
            "Player with the most apps on their phone",
            "Player who drinks the most coffee",
            "Player who exercises the most",
            "Player with the messiest desk/room",
            "Player who laughs the most",
            "Player with the best poker face",
            "Player who has read the most books this year",
            "Player who has watched the most movies this month",
            "Player with the most interesting job",
            "Player who can do the best animal impression",
            "Player who has eaten the most unusual food",
            "Player with the most colorful socks",
            "Player who has been awake the longest today",
            "Player who ate breakfast first this morning",
            "Player with the cleanest car",
            "Player who checks their phone the most",
            "Player with the most photos on their phone",
            "Player who has changed their hairstyle most recently",
            "Player wearing the most comfortable shoes",
            "Player who has the most houseplants",
            "Player who can touch their toes",
            "Player who remembers the most phone numbers",
            "Player who has visited the most museums",
            "Player with the strongest grip",
            "Player who can balance on one foot the longest"
        ];

        function selectMethod(method) {
            // Hide all method contents
            document.querySelectorAll('.method-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Hide method selector
            document.getElementById('methodSelector').style.display = 'none';
            
            // Show selected method
            document.getElementById(method + 'Method').classList.add('active');
            currentMethod = method;
            
            // Initialize method-specific setup
            if (method === 'spinner') {
                setupSpinner();
            } else if (method === 'touch') {
                setupTouchGame();
            } else if (method === 'colorpicker') {
                setupColorPicker();
            }
        }

        function showMethodSelector() {
            // Show method selector
            document.getElementById('methodSelector').style.display = 'flex';
            
            // Hide all method contents
            document.querySelectorAll('.method-content').forEach(content => {
                content.classList.remove('active');
            });
            
            currentMethod = null;
        }

        function setupSpinner() {
            const playerCount = parseInt(document.getElementById('spinnerPlayers').value);
            updatePlayerPositions(playerCount);
        }

        function updatePlayerPositions(playerCount) {
            const container = document.getElementById('playerPositions');
            container.innerHTML = '';
            
            const containerRect = document.querySelector('.spinner-circle');
            const containerSize = containerRect.offsetWidth;
            const radius = (containerSize / 2) - 35; // Subtract player circle size
            const centerX = containerSize / 2;
            const centerY = containerSize / 2;
            
            for (let i = 0; i < playerCount; i++) {
                const angle = (i * 360 / playerCount) - 90; // Start at top
                const radian = angle * Math.PI / 180;
                const x = centerX + radius * Math.cos(radian);
                const y = centerY + radius * Math.sin(radian);
                
                const position = document.createElement('div');
                position.className = 'player-position';
                position.style.left = x + 'px';
                position.style.top = y + 'px';
                position.textContent = i + 1;
                position.dataset.player = i + 1;
                position.dataset.angle = angle;
                
                container.appendChild(position);
            }
        }

        function spinWheel() {
            if (isSpinning) return;
            
            isSpinning = true;
            const playerCount = parseInt(document.getElementById('spinnerPlayers').value);
            const arrow = document.getElementById('spinnerArrow');
            const result = document.getElementById('spinnerResult');
            
            // Update positions for current player count
            updatePlayerPositions(playerCount);
            
            // Clear previous results
            result.classList.remove('show');
            document.querySelectorAll('.player-position').forEach(pos => {
                pos.classList.remove('winner');
            });
            
            // Reset arrow transform
            arrow.style.transition = 'none';
            arrow.style.transform = 'translate(-50%, -100%) rotate(0deg)';
            
            // Force a reflow to ensure the reset is applied
            arrow.offsetHeight;
            
            // Calculate target position - ensure we land close to a player
            const segmentAngle = 360 / playerCount;
            const targetPlayerIndex = Math.floor(Math.random() * playerCount);
            const targetAngle = (targetPlayerIndex * segmentAngle) + (segmentAngle / 2) + (Math.random() - 0.5) * (segmentAngle * 0.3);
            
            // Add multiple rotations for dramatic effect (8-12 full rotations)
            const extraRotations = (8 + Math.random() * 4) * 360;
            const finalAngle = extraRotations + targetAngle;
            
            // Apply the spin with custom easing (fast start, slow end)
            setTimeout(() => {
                arrow.style.transition = 'transform 4s cubic-bezier(0.15, 0, 0.2, 1)';
                arrow.style.transform = `translate(-50%, -100%) rotate(${finalAngle}deg)`;
            }, 50);
            
            // Determine winner after spin completes
            setTimeout(() => {
                // Calculate which player is closest to the arrow
                const normalizedAngle = (finalAngle % 360 + 360) % 360;
                const adjustedAngle = (normalizedAngle + 90) % 360; // Adjust for starting position
                
                let closestPlayerIndex = 0;
                let minDistance = Infinity;
                
                for (let i = 0; i < playerCount; i++) {
                    const playerAngle = (i * segmentAngle) % 360;
                    let distance = Math.abs(adjustedAngle - playerAngle);
                    if (distance > 180) distance = 360 - distance;
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestPlayerIndex = i;
                    }
                }
                
                const winnerPlayer = closestPlayerIndex + 1;
                
                // Highlight winner
                const positions = document.querySelectorAll('.player-position');
                positions[closestPlayerIndex].classList.add('winner');
                
                // Show result with celebration
                result.innerHTML = `üéâ Player ${winnerPlayer} goes first!`;
                result.classList.add('show');
                
                // Add haptic feedback on iPhone
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
                
                isSpinning = false;
            }, 4200);
        }

        function selectRandomPlayer() {
            const playerCount = parseInt(document.getElementById('numberedPlayers').value);
            const result = document.getElementById('numberedResult');
            
            if (playerCount < 2) {
                result.innerHTML = "‚ö†Ô∏è Please enter at least 2 players";
                result.classList.add('show');
                return;
            }
            
            const randomPlayer = Math.floor(Math.random() * playerCount) + 1;
            result.innerHTML = `üéâ Player ${randomPlayer} goes first!`;
            result.classList.add('show');
        }

        function generatePrompt() {
            const promptDisplay = document.getElementById('promptDisplay');
            const randomPrompt = firstPlayerPrompts[Math.floor(Math.random() * firstPlayerPrompts.length)];
            
            promptDisplay.innerHTML = `"${randomPrompt}" goes first!`;
        }

        function quickSpin() {
            const arrow = document.getElementById('directionArrow');
            const result = document.getElementById('quickSpinResult');
            
            // Clear previous result
            result.classList.remove('show');
            
            // Reset rotation
            arrow.style.transition = 'none';
            arrow.style.transform = 'rotate(0deg)';
            arrow.offsetHeight; // Force reflow
            
            // Spin the compass with improved animation
            const baseRotations = 1080 + Math.random() * 720; // 3-5 full rotations
            const randomAngle = Math.random() * 360;
            const finalAngle = baseRotations + randomAngle;
            
            setTimeout(() => {
                arrow.style.transition = 'transform 3s cubic-bezier(0.15, 0, 0.2, 1)';
                arrow.style.transform = `rotate(${finalAngle}deg)`;
            }, 50);
            
            // Show result after spin
            setTimeout(() => {
                const directions = ['‚Üë', '‚Üó', '‚Üí', '‚Üò', '‚Üì', '‚Üô', '‚Üê', '‚Üñ'];
                const directionNames = ['North', 'Northeast', 'East', 'Southeast', 'South', 'Southwest', 'West', 'Northwest'];
                const directionIndex = Math.floor(((finalAngle + 22.5) % 360) / 45);
                const direction = directions[directionIndex];
                const directionName = directionNames[directionIndex];
                
                result.innerHTML = `${direction} ${directionName}<br>This direction goes first!`;
                result.classList.add('show');
                
                // Add haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([100]);
                }
            }, 3200);
        }

        // Update player positions when count changes
        document.getElementById('spinnerPlayers').addEventListener('input', function() {
            if (currentMethod === 'spinner') {
                setupSpinner();
            }
        });

        // Touch Game Functions
        function setupTouchGame() {
            const touchArea = document.getElementById('touchArea');
            touchArea.innerHTML = '<div class="touch-message">Touch here to begin...</div><div class="countdown-display" id="countdownDisplay"></div>';
            resetTouchGame();
        }

        function startTouchGame() {
            const touchArea = document.getElementById('touchArea');
            const startBtn = document.getElementById('touchStartBtn');
            const resetBtn = document.getElementById('touchResetBtn');
            const result = document.getElementById('touchResult');
            
            result.classList.remove('show');
            touchGame.active = true;
            touchGame.touches.clear();
            touchGame.colorIndex = 0;
            
            startBtn.style.display = 'none';
            resetBtn.style.display = 'block';
            
            touchArea.innerHTML = '<div class="touch-message">All players place fingers on screen now!</div><div class="countdown-display" id="countdownDisplay"></div>';
            
            // Add touch event listeners
            touchArea.addEventListener('touchstart', handleTouchStart, { passive: false });
            touchArea.addEventListener('touchmove', handleTouchMove, { passive: false });
            touchArea.addEventListener('touchend', handleTouchEnd, { passive: false });
            
            // Start elimination countdown after 3 seconds
            setTimeout(() => {
                if (touchGame.active && touchGame.touches.size > 1) {
                    startElimination();
                } else if (touchGame.active && touchGame.touches.size === 1) {
                    endTouchGame();
                } else if (touchGame.active) {
                    document.querySelector('.touch-message').textContent = 'Need at least 2 players! Touch the screen.';
                }
            }, 3000);
        }

        function handleTouchStart(e) {
            e.preventDefault();
            if (!touchGame.active) return;
            
            const rect = e.target.getBoundingClientRect();
            
            for (let touch of e.changedTouches) {
                if (!touchGame.touches.has(touch.identifier)) {
                    const x = touch.clientX - rect.left;
                    const y = touch.clientY - rect.top;
                    const color = touchGame.colors[touchGame.colorIndex % touchGame.colors.length];
                    
                    const touchPoint = document.createElement('div');
                    touchPoint.className = 'touch-point';
                    touchPoint.style.left = x + 'px';
                    touchPoint.style.top = y + 'px';
                    touchPoint.style.backgroundColor = color;
                    touchPoint.textContent = (touchGame.colorIndex + 1);
                    touchPoint.id = `touch-${touch.identifier}`;
                    
                    e.target.appendChild(touchPoint);
                    
                    touchGame.touches.set(touch.identifier, {
                        element: touchPoint,
                        color: color,
                        number: touchGame.colorIndex + 1,
                        x: x,
                        y: y
                    });
                    
                    touchGame.colorIndex++;
                }
            }
            
            // Hide the instruction message when touches start
            const message = document.querySelector('.touch-message');
            if (message && touchGame.touches.size > 0) {
                message.style.display = 'none';
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!touchGame.active) return;
            
            const rect = e.target.getBoundingClientRect();
            
            for (let touch of e.changedTouches) {
                const touchData = touchGame.touches.get(touch.identifier);
                if (touchData) {
                    const x = touch.clientX - rect.left;
                    const y = touch.clientY - rect.top;
                    touchData.element.style.left = x + 'px';
                    touchData.element.style.top = y + 'px';
                    touchData.x = x;
                    touchData.y = y;
                }
            }
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            if (!touchGame.active) return;
            
            for (let touch of e.changedTouches) {
                const touchData = touchGame.touches.get(touch.identifier);
                if (touchData) {
                    touchData.element.remove();
                    touchGame.touches.delete(touch.identifier);
                }
            }
            
            // If only one or no touches left during elimination, end the game
            if (touchGame.touches.size <= 1 && touchGame.eliminationTimer) {
                endTouchGame();
            }
        }

        function startElimination() {
            if (touchGame.touches.size <= 1) {
                endTouchGame();
                return;
            }
            
            const countdownDisplay = document.getElementById('countdownDisplay');
            countdownDisplay.style.display = 'block';
            
            let countdown = 5;
            countdownDisplay.textContent = countdown;
            
            touchGame.countdownTimer = setInterval(() => {
                countdown--;
                countdownDisplay.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(touchGame.countdownTimer);
                    eliminateRandomPlayer();
                }
            }, 1000);
        }

        function eliminateRandomPlayer() {
            const activeTouches = Array.from(touchGame.touches.values());
            if (activeTouches.length <= 1) {
                endTouchGame();
                return;
            }
            
            // Remove random player
            const randomIndex = Math.floor(Math.random() * activeTouches.length);
            const eliminatedTouch = activeTouches[randomIndex];
            
            eliminatedTouch.element.classList.add('eliminated');
            
            // Remove from active touches
            for (let [id, touch] of touchGame.touches) {
                if (touch === eliminatedTouch) {
                    touchGame.touches.delete(id);
                    break;
                }
            }
            
            // Add haptic feedback
            if (navigator.vibrate) {
                navigator.vibrate([100]);
            }
            
            // Continue elimination after 1.5 seconds
            setTimeout(() => {
                eliminatedTouch.element.remove();
                
                if (touchGame.touches.size > 1) {
                    startElimination();
                } else {
                    endTouchGame();
                }
            }, 1500);
        }

        function endTouchGame() {
            touchGame.active = false;
            clearInterval(touchGame.eliminationTimer);
            clearInterval(touchGame.countdownTimer);
            
            const countdownDisplay = document.getElementById('countdownDisplay');
            countdownDisplay.style.display = 'none';
            
            const result = document.getElementById('touchResult');
            const activeTouches = Array.from(touchGame.touches.values());
            
            if (activeTouches.length === 1) {
                const winner = activeTouches[0];
                winner.element.classList.add('winner');
                result.innerHTML = `üéâ Player ${winner.number} (${winner.color}) goes first!`;
                result.style.color = winner.color;
            } else if (activeTouches.length === 0) {
                result.innerHTML = `ü§∑ No players remaining. Try again!`;
                result.style.color = '#fff';
            } else {
                result.innerHTML = `üéâ ${activeTouches.length} players tied!`;
                result.style.color = '#fff';
            }
            
            result.classList.add('show');
            
            // Add haptic feedback for winner
            if (navigator.vibrate && activeTouches.length === 1) {
                navigator.vibrate([200, 100, 200]);
            }
        }

        function resetTouchGame() {
            touchGame.active = false;
            touchGame.touches.clear();
            touchGame.colorIndex = 0;
            clearInterval(touchGame.eliminationTimer);
            clearInterval(touchGame.countdownTimer);
            
            const touchArea = document.getElementById('touchArea');
            const startBtn = document.getElementById('touchStartBtn');
            const resetBtn = document.getElementById('touchResetBtn');
            const result = document.getElementById('touchResult');
            
            // Remove event listeners
            touchArea.removeEventListener('touchstart', handleTouchStart);
            touchArea.removeEventListener('touchmove', handleTouchMove);
            touchArea.removeEventListener('touchend', handleTouchEnd);
            
            touchArea.innerHTML = '<div class="touch-message">Touch here to begin...</div><div class="countdown-display" id="countdownDisplay"></div>';
            startBtn.style.display = 'block';
            resetBtn.style.display = 'none';
            result.classList.remove('show');
        }

        // Color Picker Functions
        function setupColorPicker() {
            const colorGrid = document.getElementById('colorGrid');
            colorGrid.innerHTML = '';
            
            colorOptions.forEach((colorOption, index) => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'color-option';
                colorDiv.style.backgroundColor = colorOption.color;
                colorDiv.innerHTML = `<div class="color-label">${colorOption.name}</div>`;
                colorDiv.onclick = () => selectColor(index);
                colorGrid.appendChild(colorDiv);
            });
        }

        function selectColor(index) {
            const result = document.getElementById('colorResult');
            const selectedColor = colorOptions[index];
            
            // Clear previous selections
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected', 'winner');
            });
            
            // Highlight selected color
            document.querySelectorAll('.color-option')[index].classList.add('selected');
            
            result.innerHTML = `üé® ${selectedColor.name} player goes first!`;
            result.style.color = selectedColor.color;
            result.classList.add('show');
        }

        function pickRandomColor() {
            const randomIndex = Math.floor(Math.random() * colorOptions.length);
            const selectedColor = colorOptions[randomIndex];
            const result = document.getElementById('colorResult');
            
            // Clear previous selections
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected', 'winner');
            });
            
            // Animate selection
            const colorOptions_dom = document.querySelectorAll('.color-option');
            let currentIndex = 0;
            
            const selectionInterval = setInterval(() => {
                // Clear previous highlight
                colorOptions_dom.forEach(option => option.classList.remove('selected'));
                
                // Highlight current
                colorOptions_dom[currentIndex].classList.add('selected');
                currentIndex = (currentIndex + 1) % colorOptions_dom.length;
            }, 100);
            
            // Stop on random color after 2 seconds
            setTimeout(() => {
                clearInterval(selectionInterval);
                
                // Clear all and select final
                colorOptions_dom.forEach(option => option.classList.remove('selected'));
                colorOptions_dom[randomIndex].classList.add('winner');
                
                result.innerHTML = `üéâ ${selectedColor.name} player goes first!`;
                result.style.color = selectedColor.color;
                result.classList.add('show');
                
                // Add haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
            }, 2000);
        }
    </script>
</body>
</html>