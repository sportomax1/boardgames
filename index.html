<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BGG Custom App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1 style="text-align:center;">BGG Collection Analyzer!</h1>
    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1em; border:2px dashed #0078d4; border-radius:10px; padding:1em; background:#fafdff;">
        <div>
            <div style="font-weight:600; margin-bottom:0.3em;">Collection Actions</div>
            <button id="fetchBtn" class="modern-btn" aria-label="Fetch your BGG collection">Fetch Sportomax</button>
            <button id="tierRankBtn" class="modern-btn" style="margin-left: 1em;" aria-label="Start tier ranking">Tier Rank</button>
            <button id="randomGameBtn" class="modern-btn" style="margin-left: 1em;" aria-label="Pick a random game">Random Game</button>

            <!-- Random Game Popup -->
            <div id="randomGamePopup" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.45); z-index:9999; align-items:center; justify-content:center;">
                <div style="background:#fff; border-radius:16px; box-shadow:0 4px 32px #0003; max-width:420px; width:90vw; margin:auto; padding:2em 1.5em; text-align:center; position:relative;">
                    <button id="closeRandomGamePopup" style="position:absolute; top:10px; right:14px; background:none; border:none; font-size:1.5em; color:#888; cursor:pointer;">&times;</button>
                    <div id="randomGameContent"></div>
                    <button id="regenRandomGameBtn" class="modern-btn" style="margin-top:1.2em;">Pick Another</button>
                </div>
            </div>
            <div style="display:inline-block; margin-left:1em;">
                <button id="downloadComboBtn" class="modern-btn" aria-label="Download current view">Download ▼</button>
                <div id="downloadDropdown" style="display:none; position:absolute; background:#fff; border:1px solid #0078d4; border-radius:5px; box-shadow:0 2px 8px rgba(0,0,0,0.12); z-index:1000; min-width:120px;">
                    <button id="downloadCsvBtn" class="modern-btn" style="width:100%; border-radius:0; border-bottom:1px solid #eee; background:#fff; color:#222; text-align:left; padding:0.5em 1em;" aria-label="Download current view as CSV">Download CSV</button>
                    <button id="downloadXlsxBtn" class="modern-btn" style="width:100%; border-radius:0 0 5px 5px; background:#fff; color:#222; text-align:left; padding:0.5em 1em;" aria-label="Download current view as XLSX">Download XLSX</button>
                </div>
            </div>
            <button id="openWelcomeBtn" style="margin-left:1em; background:#d32f2f; color:#fff; border:none; border-radius:6px; padding:10px 20px; font-size:1rem; font-weight:600; box-shadow:0 2px 8px rgba(0,0,0,0.08); cursor:pointer; transition:background 0.2s, box-shadow 0.2s, transform 0.1s;" aria-label="Open Welcome Page">Open Welcome Page</button>
        </div>
        <div style="min-width:340px; text-align:right; font-size:1em;">
            <div style="font-weight:600; margin-bottom:0.2em;">API Timing & Collection Summary</div>
            <span id="timingInfo" aria-label="API timing info"></span>
        </div>
    </div>
    <div style="margin-bottom: 1em; text-align: center; border:2px dashed #0078d4; border-radius:10px; padding:1em; background:#fafdff;">
        <div style="font-weight:600; margin-bottom:0.3em;">View & Search Options</div>
        <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:1em; align-items:center;">
            <div>
                <label for="userSelect" style="font-weight:bold; margin-right:0.5em;">User:</label>
                <select id="userSelect" class="modern-btn" style="min-width:120px; font-size:1em; padding:0.4em 1em; background:#fff; color:#222; border:1.5px solid #0078d4; border-radius:5px;">
                    <option value="sportomax">sportomax</option>
                    <option value="dtwlibrary">dtwlibrary</option>
                </select>
            </div>
            <div>
                <input type="text" id="searchInput" placeholder="Search games by name..." style="padding: 8px; width: 220px; font-size: 14px;" aria-label="Search games by name">
                <button id="clearSearchBtn" style="margin-left: 0.5em;" aria-label="Clear search">Clear</button>
                <!-- <span style="font-size:0.95em; color:#666; margin-left:0.5em;">Type to filter by game name</span> -->
            </div>
            <div>
                <div style="font-weight:bold; font-size:1.1em; margin-bottom:0.2em;">Preset Views:</div>
                <select id="presetViewsDropdown" class="modern-btn" style="min-width:260px; font-size:1em; padding:0.4em 1em; background:#fff; color:#222; border:1.5px solid #0078d4; border-radius:5px; box-shadow:0 1px 4px rgba(0,0,0,0.07);">
                    <option value="">-- Select a View --</option>
                    <option value="quick">Quick Games</option>
                    <option value="newest">New Games</option>
                    <option value="mostPlayed">Most Played Games</option>
                    <option value="bestRating">Best Rating</option>
                    <option value="wantToPlay">Want to Play (by Rating)</option>
                    <option value="wantToBuy">Want to Buy Games</option>
                    <option value="prevOwned">Prev Owned (by Bayes Avg)</option>
                    <option value="all">Show All</option>
                </select>
            </div>
            <div>
                <button id="simpleViewBtn" class="modern-btn" aria-label="Toggle simple/full table view">Simple View</button>
            </div>
        </div>
    </div>
    <div style="font-weight:600; margin-bottom:0.3em; text-align:center; border:2px dashed #0078d4; border-radius:10px; padding:0.5em 0.5em 0.7em 0.5em; background:#fafdff;">
        Main Filter Buttons
        <div style="margin:0.3em 0 0.2em 0; text-align:center;">
            <span>Filter by player count:</span>
            <span id="playerCountCheckboxes">
                <script>for(let n=1;n<=12;n++)document.write(`<label style='margin:0 2px;'><input type='checkbox' value='${n}' class='playerCountBox'/>${n}</label>`);</script>
            </span>
            <button id="applyPlayerFilterBtn" class="modern-btn" style="margin-left:0.3em;">Apply</button>
            <button id="clearPlayerFilterBtn" class="modern-btn" style="margin-left:0.3em;">Clear</button>
            <span id="selectedPlayerCounts" style="margin-left:0.7em;color:#0078d4;"></span>
        </div>
        <div id="statusFlagFilter" style="margin:0.2em 0 0.3em 0; text-align:center;">
            <span style="font-weight:bold;">Status Flags:</span>
            <label style='margin:0 4px;'><input type='checkbox' class='statusFlagBox' data-flag='own'>Own</label>
            <label style='margin:0 4px;'><input type='checkbox' class='statusFlagBox' data-flag='prevowned'>Prev Owned</label>
            <label style='margin:0 4px;'><input type='checkbox' class='statusFlagBox' data-flag='fortrade'>For Trade</label>
            <label style='margin:0 4px;'><input type='checkbox' class='statusFlagBox' data-flag='want'>Want</label>
            <label style='margin:0 4px;'><input type='checkbox' class='statusFlagBox' data-flag='wanttoplay'>Want to Play</label>
            <label style='margin:0 4px;'><input type='checkbox' class='statusFlagBox' data-flag='wanttobuy'>Want to Buy</label>
            <label style='margin:0 4px;'><input type='checkbox' class='statusFlagBox' data-flag='wishlist'>Wishlist</label>
            <label style='margin:0 4px;'>Wishlist Priority: <input type='number' min='0' max='5' value='' class='statusFlagInput' data-flag='wishlistpriority' style='width:2.5em;'></label>
            <label style='margin:0 4px;'><input type='checkbox' class='statusFlagBox' data-flag='preordered'>Preordered</label>
            <button id="applyStatusFlagBtn" class="modern-btn" style="margin-left:0.3em;">Apply</button>
            <button id="clearStatusFlagBtn" class="modern-btn" style="margin-left:0.3em;">Clear</button>
            <span id="selectedStatusFlags" style="margin-left:0.7em;color:#0078d4;"></span>
        </div>
    </div>
    <div style="font-weight:600; margin-bottom:0.3em; text-align:center; border:2px dashed #0078d4; border-radius:10px; padding:0.5em; background:#fafdff;">Games Table & Filters</div>
    <div id="results-container" style="position:relative;">
        <button id="fullscreenTableBtn" title="Toggle Fullscreen Table" style="position:absolute; top:8px; right:12px; z-index:10; background:#1976d2; color:#fff; border:none; border-radius:5px; padding:6px 14px; font-size:1.1em; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.08);">⛶</button>
        <div id="results" aria-label="Games table and filters" style="border:2px dashed #0078d4; border-radius:10px; padding:1em; background:#fafdff;"></div>
    </div>
    <div id="collage-controls" style="text-align:center; margin:1.5em 0 1em 0;">
        <label for="collage-x" style="font-weight:bold;">Columns (X):</label>
        <select id="collage-x" style="width:3em; margin-right:1em;">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5" selected>5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select>
        <label for="collage-y" style="font-weight:bold;">Rows (Y):</label>
        <select id="collage-y" style="width:3em; margin-right:1em;">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5" selected>5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select>
    <button id="collageCreateBtn" class="modern-btn" aria-label="Create custom collage">Create Collage</button>
    <button id="copyCollageBtn" class="modern-btn" aria-label="Copy collage image" style="margin-left:1em;">Copy Collage</button>
    <button id="downloadCollageBtn" class="modern-btn" aria-label="Download collage image" style="margin-left:1em;">Download Collage</button>

    <button id="openWelcomeBtn" style="margin-left:1em; background:#d32f2f; color:#fff; border:none; border-radius:6px; padding:10px 20px; font-size:1rem; font-weight:600; box-shadow:0 2px 8px rgba(0,0,0,0.08); cursor:pointer; transition:background 0.2s, box-shadow 0.2s, transform 0.1s;" aria-label="Open Welcome Page">Open Welcome Page</button>
    <!-- Welcome Modal removed: now opens in new tab -->
    <button id="toggleCollageModeBtn" class="modern-btn" aria-label="Toggle collage zoom/widescreen" style="margin-left:1em;">Toggle Zoom/Widescreen</button>
    </div>
    <div id="collage-container" style="display:flex; justify-content:center; align-items:center; min-height:340px; margin-bottom:2em;"></div>
    <div id="rankingInterface" style="display: none; border:2px dashed #0078d4; border-radius:10px; padding:1em; background:#fafdff;" aria-label="Pairwise ranking interface"></div>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="app.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var openWelcomeBtn = document.getElementById('openWelcomeBtn');
        if (openWelcomeBtn) {
            openWelcomeBtn.onclick = function() {
                window.open('welcome.html', '_blank');
            };
        }
    });
    </script>
</body>
</html>